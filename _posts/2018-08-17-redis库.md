---
layout: post
title: '[python] redis 库'
subtitle: '简单地实现 key-value 存储'
date: 2018-08-17
categories: python
cover: '../../../assets/img/redis-header.jpg'
tags: python python库 python第三方库
---

Redis 可以说是 NoSQL （非关系型数据库）中较为流行的一种数据库，虽然相较于 MongoDB ， Redis 的检索算法不够全面，但是它的性能更好，对数据持久化的处理也较优。

所以在建立数据库时，也经常会用到 Redis ，而且一般用它和其他数据库相互组合使用。相较于 SQL ， Redis 可以很好地处理缓存类的部分，并且更易实现分布式，从而提升服务器的访问效率。

### 1. 安装 redis 和 python 第三方库

Redis 的服务器文件我们需要到它的官网上去下载：[Redis.io](https://redis.io) 。

下载完成后，我们解压文件，然后打开控制台，切换到解压后的目录下，然后输入 `make` 指令，经过一段时间的安装后， Redis 就安装成功了。

安装好了服务器之后，我们需要安装 python 的 redis 第三方库，来实现对 Redis 连接的支持。

```bash
$ pip install redis
```

### 2. 连接 Redis 数据库

首先我们先以普通模式运行 Redis 数据库，打开终端，可以看到一个 Redis 的图标。

```bash
$ redis-server
```

![Redis_bash](../../../assets/screenshot/redis-1.png)

>在调试完成后，我们应该使用conf配置文件打开 Redis 服务器，不然会有安全性隐患。

在 python 中，我们可以通过定义一个 Redis 对象来实现对 Redis 数据库的连接。这里我们先使用 IDLE 的交互式编程模式来完成。

```python
>>> import redis
>>> database = redis.Redis(host='localhost', port=6379)
```

其中， `Redis` 这个函数其实还有其他可选参数，`password` 和 `db` ，其中在服务器设置了密码时需要设置 `password` 参数。如果需要分多个数据仓库，可以设置 `db` 参数，不过默认为 `db = 0` 。

### 3. 对数据库进行操作

Redis 的操作非常简单，最基础的只有两个函数， `set()` 和 `get()` 。

* redis.set(key, value)
将 key 对应的值设置为 value ，如果设置成功就返回 `True`

* redis.get(key)
返回 key 对应的值，如果 key 不存在，则返回 None

让我们先来试一试这两个函数：

```python
>>> database.set('username', 'cometeme')
True
>>> database.get('username')
b'cometeme'
```
可以看到，虽然的确成功返回了我们存入的信息，但是前面多了一个 `b'` ，这代表的是这是 byte 形式的值。那么怎么样才能还原成正常的数据呢？

其实只需要加个 `decode` 函数就可以恢复为正常的数据。

```python
>>> database.get('username').decode()
'cometeme'
```

假如你存了许多键值对，想要查看所有设置过的键值对，那么你就可以使用 `redis.keys()` 这个函数来返回所有键。

```python
>>> database.keys()
[b'passwd', b'username']
```

这样返回的又都是带 `b'` 的数据了，如果想要将它全部复原的话，我们可以使用 `for` 循环来完成解码，这样就解决问题。，但是每一次使用这些功能时，都需要设置这么多的步骤。其实我们可以自己做一个模块，从而能够在其他程序中更简单地完成这些操作。

### 4. 写一个简单的 Redis 操作模块

待施工...
